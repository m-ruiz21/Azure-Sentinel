{
  "name": "QualysKBLogsCCPDefinition",
  "apiVersion": "2025-03-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "QualysKBLogsCCPDefinition",
      "title": "Qualys Vulnerability Management KnowledgeBase (KB)",
      "publisher": "Qualys",
      "descriptionMarkdown": "The Qualys Vulnerability Management (VM) KnowledgeBase (KB) data connector provides the capability to ingest Qualys KB vulnerability data into Microsoft Sentinel using the REST API. The connector provides visibility into vulnerability details, threat intelligence, and security recommendations from Qualys KnowledgeBase.",
      "graphQueriesTableName": "QualysKB_CL",
      "graphQueries": [
        {
          "metricName": "Total data received",
          "legend": "QualysKB Events",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "All Qualys KB vulnerabilities",
          "query": "{{graphQueriesTableName}}\n| sort by TimeGenerated desc"
        },
        {
          "description": "Get sample of Qualys KB vulnerabilities",
          "query": "{{graphQueriesTableName}}\n| take 10"
        },
        {
          "description": "Summary by severity level",
          "query": "{{graphQueriesTableName}}\n| summarize count() by SEVERITY_LEVEL"
        }
      ],
      "dataTypes": [
        {
          "name": "QualysKB_CL",
          "lastDataReceivedQuery": "QualysKB_CL\n| where TimeGenerated > ago(12h)\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          }
        ],
        "customs": [
          {
            "name": "Qualys VM API Credentials",
            "description": "Qualys VM username and password with API access permissions are required. For more information, see the [Qualys API User Guide](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf)."
          },
          {
            "name": "Qualys VM API Server URL",
            "description": "The Qualys API server URL is required. The format should be https://qualysapi.{platform}.{domain}/api/2.0 where platform and domain correspond to your Qualys subscription."
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "1. Obtain Qualys VM API credentials",
          "description": "To connect to Qualys VM API, you need:\n- Qualys VM username with API access permissions\n- Qualys VM password\n- Qualys API server URL (e.g., https://qualysapi.qualys.com/api/2.0)\n\nFor more information, see the [Qualys API User Guide](https://www.qualys.com/docs/qualys-api-vmpc-user-guide.pdf).",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "API Server URL",
                "placeholder": "Enter your Qualys API server URL. The format should be https://qualysapi.{platform}.{domain}/api/2.0",
                "type": "text",
                "name": "apiServerUrl"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Username",
                "placeholder": "The Qualys VM API username",
                "type": "text",
                "name": "username"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Password",
                "placeholder": "The Qualys VM API password",
                "type": "password",
                "name": "password"
              }
            }
          ]
        },
        {
          "title": "2. Configure the connector",
          "description": "Click the **Connect** button below to enable the Qualys KB data connector. This will deploy the necessary Azure resources to start collecting vulnerability data from your Qualys KnowledgeBase.",
          "instructions": [
            {
              "type": "ConnectionToggleButton",
              "parameters": {
                "connectLabel": "Connect to Qualys KnowledgeBase",
                "disconnectLabel": "Disconnect",
                "name": "QualysKBLogsCCP"
              }
            }
          ]
        }
      ]
    }
  }
}